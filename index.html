<!doctype html>
<html lang="sk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Crionic • CoinPaprika Dashboard</title>
<style>
:root{--bg:#050608;--neon-a:#00ffd5;--neon-b:#7b61ff;--text:#cfeee8;--muted:#94a3b8;--accent:#7be495}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;background:linear-gradient(180deg,#030406,#07080b);font-family:Inter,system-ui,Arial;color:var(--text)}
.container{padding:20px;max-width:1200px;margin:0 auto}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
.title{font-weight:800;color:var(--neon-a);font-size:20px}
.sub{color:var(--muted);font-size:13px}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
.card{background:rgba(255,255,255,0.03);backdrop-filter:blur(8px);border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.04);position:relative;overflow:hidden}
.h3{font-size:13px;color:var(--accent);margin-bottom:8px}
.row{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px dashed rgba(255,255,255,0.02)}
.row:last-child{border-bottom:0}
.val{font-weight:700}
.muted{color:var(--muted);font-size:13px}
.btn{padding:7px 10px;border-radius:10px;background:linear-gradient(90deg,var(--neon-b),var(--neon-a));color:#041018;font-weight:700;text-decoration:none;border:none;cursor:pointer}
.bar{height:12px;background:rgba(255,255,255,0.03);border-radius:999px;overflow:hidden}
.bar>i{display:block;height:100%;width:0%;background:linear-gradient(90deg,var(--neon-a),var(--neon-b));transition:width .9s}
.log{font-family:monospace;color:var(--muted);font-size:12px;max-height:220px;overflow:auto;padding:8px;background:rgba(0,0,0,0.2);border-radius:8px}
.footer{margin-top:14px;color:var(--muted);font-size:12px;text-align:center}
@media(max-width:980px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <div class="title">Crionic Dashboard</div>
        <div class="sub">Pripojené len na CoinPaprika • live market data</div>
      </div>
      <div>
        <button id="btnRefresh" class="btn">Manual refresh</button>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="h3">Market (CoinPaprika) — CRNC</div>
        <div class="row"><div class="muted">Cena (USD)</div><div id="price" class="val">—</div></div>
        <div class="row"><div class="muted">24h Zmena</div><div id="percent" class="val">—</div></div>
        <div class="row"><div class="muted">Market Cap</div><div id="mcap" class="val">—</div></div>
        <div class="row"><div class="muted">Obchodný objem 24h</div><div id="vol" class="val">—</div></div>
        <div style="margin-top:10px" class="row"><div class="muted">Supply</div><div id="supply" class="val">—</div></div>
      </div>

      <div class="card">
        <div class="h3">Price Spark</div>
        <div style="padding:8px 0">
          <div class="bar"><i id="priceBar"></i></div>
        </div>
        <div style="margin-top:12px" class="muted">Last updated: <span id="lastUpdated">—</span></div>
        <div style="margin-top:12px">
          <a class="btn" id="cpLink" href="https://coinpaprika.com/coin/crnc-crionic/" target="_blank">Open on CoinPaprika</a>
        </div>
      </div>

      <div class="card">
        <div class="h3">Quick Logs</div>
        <div id="logArea" class="log">—</div>
      </div>

      <div class="card" style="grid-column:span 3">
        <div class="h3">Notes & links</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <a class="btn" href="https://github.com/diabaths/Crionic-Coin/releases" target="_blank">Crionic Wallet</a>
          <a class="btn" href="https://github.com/doktor83/SRBMiner-Multi/releases" target="_blank">SRB Miner</a>
          <a class="btn" href="https://trade.nestex.one/spot/CRNC_USDT" target="_blank">Nestex CRNC/USDT</a>
        </div>
      </div>
    </div>

    <div class="footer">Dashboard beží cez proxy • verejné nasadenie: hostni server.js (Render/Vercel/VPS)</div>
  </div>

<script>
/* FULL file code: only CoinPaprika used. Proxy required for public hosting. */
const cfg = {
  coinpaprika: '/proxy?url=https://api.coinpaprika.com/v1/tickers/crnc-crionic',
  fastInterval: 1000,
  slowInterval: 10000,
  fetchTimeout: 6000
};

function log(msg){ const el=document.getElementById('logArea'); el.textContent = new Date().toISOString() + '  ' + msg + '\n' + el.textContent; }
function setBar(p){ const e=document.getElementById('priceBar'); e.style.width = Math.max(0, Math.min(100, p)) + '%'; }
function fmt(n){ if(!n && n!==0) return '—'; if(n>=1000000) return (n/1000000).toFixed(2)+'M'; if(n>=1000) return (n/1000).toFixed(2)+'K'; return Number(n).toFixed(6); }

async function fetchWithTimeout(url, timeout = cfg.fetchTimeout){
  const controller = new AbortController();
  const id = setTimeout(()=>controller.abort(), timeout);
  try{
    const res = await fetch(url, {signal: controller.signal});
    clearTimeout(id);
    const ct = res.headers.get('content-type')||'';
    if(ct.includes('application/json')) return await res.json();
    const text = await res.text();
    try{ return JSON.parse(text); } catch { return text; }
  }catch(e){
    clearTimeout(id);
    throw e;
  }
}

async function updateMarket(){
  try{
    const data = await fetchWithTimeout(cfg.coinpaprika);
    if(!data){ log('coinpaprika: no data'); return; }
    // coinpaprika ticker structure:
    // price_usd or quotes.USD.price
    const price = data?.quotes?.USD?.price ?? data?.price_usd ?? null;
    const percent = data?.quotes?.USD?.percent_change_24h ?? data?.percent_change_24h ?? null;
    const mcap = data?.market_cap ?? (data?.quotes?.USD?.market_cap ?? null);
    const vol = data?.volume_24h ?? (data?.quotes?.USD?.volume_24h ?? null);
    const supply = data?.circulating_supply ?? data?.circulating_supply;

    document.getElementById('price').textContent = price ? '$' + Number(price).toFixed(6) : '—';
    document.getElementById('percent').textContent = percent !== null ? (Number(percent).toFixed(2) + '%') : '—';
    document.getElementById('mcap').textContent = mcap ? '$' + (mcap >= 1e9 ? (mcap/1e9).toFixed(2)+'B' : (mcap>=1e6 ? (mcap/1e6).toFixed(2)+'M' : Number(mcap).toFixed(2))) : '—';
    document.getElementById('vol').textContent = vol ? '$' + fmt(vol) : '—';
    document.getElementById('supply').textContent = supply ? Number(supply).toLocaleString() : '—';

    // simple price-based bar: scale price into 0-100 using sliding window heuristic
    // we compute a moving window between minPriceSeen..maxPriceSeen in this session
    updateMarket.min = updateMarket.min ?? Number(price) ?? 0;
    updateMarket.max = updateMarket.max ?? Number(price) ?? 0;
    const pnum = Number(price) || 0;
    if(pnum < updateMarket.min) updateMarket.min = pnum;
    if(pnum > updateMarket.max) updateMarket.max = pnum;
    const range = (updateMarket.max - updateMarket.min) || 1;
    const pct = ((pnum - updateMarket.min) / range) * 100;
    setBar(pct);

    document.getElementById('lastUpdated').textContent = new Date().toLocaleTimeString();
    log('coinpaprika fetched: price ' + (price ? '$'+Number(price).toFixed(6) : '—'));
  }catch(e){
    log('coinpaprika error: ' + (e.message || e));
    document.getElementById('price').textContent = '—';
  }
}

// manual refresh button
document.getElementById('btnRefresh').addEventListener('click', ()=>{ updateMarket(); });

updateMarket();
setInterval(updateMarket, cfg.fastInterval);
</script>
</body>
</html>
